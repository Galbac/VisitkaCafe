{% extends 'main/base.html' %}
{% load static %}
{% block title %}–ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ - –ï–¥–∞ –±–µ–∑ –≤—Ä–µ–¥–∞{% endblock %}
{% block description %}–ù–∞–π–¥–∏—Ç–µ –ø–æ–ª–µ–∑–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è –±–µ–∑ —Å–∞—Ö–∞—Ä–∞, –≥–ª—é—Ç–µ–Ω–∞ –∏ –ì–ú–û. –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é.{% endblock %}

{% block content %}
<div class="search-container">
    <div class="search-header">
        <h1 class="search-title">
            {% if query %}
            <span class="search-title-main">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</span>
            <span class="search-title-query">"{{ query }}"</span>
            {% else %}
            <span class="search-title-main">–ù–∞–π–¥–∏—Ç–µ –ø–æ–ª–µ–∑–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç</span>
            <span class="search-title-sub">–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</span>
            {% endif %}
        </h1>
        {% if products %}
        {% if paginator.count is not None %}
        <div class="search-stats">
            –ù–∞–π–¥–µ–Ω–æ: <span class="stats-number">{{ paginator.count }}</span> –ø—Ä–æ–¥—É–∫—Ç{{ paginator.count|pluralize:"–∞,–æ–≤"
            }}
            {% if is_paginated %}
            (–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }})
            {% endif %}
        </div>
        {% elif products %}
        <div class="search-stats">
            –ù–∞–π–¥–µ–Ω–æ: <span class="stats-number">{{ products|length }}</span> –ø—Ä–æ–¥—É–∫—Ç{{ products|length|pluralize:"–∞,–æ–≤"
            }}
        </div>
        {% endif %}
        {% endif %}
    </div>

    <div class="products-grid" id="productsGrid">
        {% if products %}
        {% for product in products %}
        <div class="product-card" data-slug="{{ product.slug }}" tabindex="0">
            <div class="product-img-wrap">
                {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-img-mini" loading="lazy">
                {% else %}
                <div class="product-img-placeholder">
                    <span class="placeholder-icon">üç≤</span>
                </div>
                {% endif %}
            </div>
            <div class="product-content">
                <h3 class="product-name">{{ product.name }}</h3>
                <p class="product-desc">{{ product.description|truncatechars:40 }}</p>
                <div class="product-cta">
                    <span class="cta-text">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</span>
                    <span class="cta-icon">‚Üí</span>
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="no-results">
            <div class="no-results-icon">
                {% if query %}
                üîç
                {% else %}
                üí≠
                {% endif %}
            </div>
            <h3 class="no-results-title">
                {% if query %}
                –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                {% else %}
                –ù–∞—á–Ω–∏—Ç–µ –ø–æ–∏—Å–∫
                {% endif %}
            </h3>
            <p class="no-results-text">
                {% if query %}
                –ü–æ –∑–∞–ø—Ä–æ—Å—É <strong>"{{ query }}"</strong> –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å.
                {% else %}
                –í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ —Å—Ç—Ä–æ–∫–µ –ø–æ–∏—Å–∫–∞ –≤—ã—à–µ, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç—ã.
                {% endif %}
            </p>
            <div class="no-results-actions">
                <a href="{% url 'home' %}" class="no-results-button primary">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                <a href="{% url 'products' %}" class="no-results-button secondary">–ö –∫–∞—Ç–∞–ª–æ–≥—É</a>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if is_paginated %}
    <div class="pagination-wrapper">
        <ul class="pagination">
            {% if page_obj.has_previous %}
            <li><a href="?query={{ query|urlencode }}&page=1" class="page-link">&laquo; –ü–µ—Ä–≤–∞—è</a></li>
            <li><a href="?query={{ query|urlencode }}&page={{ page_obj.previous_page_number }}" class="page-link">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
            </li>
            {% endif %}
            {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
            <li><span class="page-link current">{{ num }}</span></li>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <li><a href="?query={{ query|urlencode }}&page={{ num }}" class="page-link">{{ num }}</a></li>
            {% endif %}
            {% endfor %}
            {% if page_obj.has_next %}
            <li><a href="?query={{ query|urlencode }}&page={{ page_obj.next_page_number }}"
                   class="page-link">–°–ª–µ–¥—É—é—â–∞—è</a></li>
            <li><a href="?query={{ query|urlencode }}&page={{ page_obj.paginator.num_pages }}" class="page-link">–ü–æ—Å–ª–µ–¥–Ω—è—è
                &raquo;</a></li>
            {% endif %}
        </ul>
    </div>
    {% endif %}
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (–ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–∞–∫ –≤ products.html) -->
<div id="productModal" class="modal" role="dialog" aria-labelledby="modalName">
    <div class="modal-overlay" tabindex="-1"></div>
    <div class="modal-content">
        <button class="modal-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
        <div class="modal-body">
            <div class="modal-spinner" id="modalSpinner" style="display: none;">
                <div class="spinner"></div>
            </div>
            <div class="modal-img-wrap">
                <img id="modalImg" src="" alt="">
            </div>
            <h3 id="modalName" class="modal-name"></h3>
            <p id="modalDesc" class="modal-desc"></p>
            <div class="modal-info-block">
                <strong>–í–µ—Å:</strong>
                <span id="modalWeight"></span>
            </div>
            <div class="modal-info-block composition-block">
                <strong>–°–æ—Å—Ç–∞–≤:</strong>
                <ul class="ingredients-list" id="compositionList"></ul>
            </div>
            <div class="macro-block">
                <h4>–ü–∏—â–µ–≤–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å –Ω–∞ 100 –≥:</h4>
                <div class="macro-grid">
                    <div class="macro-item">
                        <span class="macro-label">–ö–∞–ª–æ—Ä–∏–∏</span>
                        <span class="macro-value" id="modalCalories"></span>
                    </div>
                    <div class="macro-item">
                        <span class="macro-label">–ë–µ–ª–∫–∏</span>
                        <span class="macro-value" id="modalProteins"></span>
                    </div>
                    <div class="macro-item">
                        <span class="macro-label">–ñ–∏—Ä—ã</span>
                        <span class="macro-value" id="modalFats"></span>
                    </div>
                    <div class="macro-item">
                        <span class="macro-label">–£–≥–ª–µ–≤–æ–¥—ã</span>
                        <span class="macro-value" id="modalCarbs"></span>
                    </div>
                </div>
            </div>
            <div id="modalTech" class="modal-tech"></div>
            <div id="modalCert" class="modal-cert"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<link href="{% static 'assets/css/search_results.css' %}" rel="stylesheet">
{% endblock %}

{% block extra_js %}
<script src="{% static 'assets/js/search_results.js' %}"></script>
{% endblock %}